<!DOCTYPE html>
<html>
<head>
    <title>Flashcard C√° Nh√¢n</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 20px auto;
            padding: 10px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --input-bg: #ffffff;
            --input-text: #000000;
            --card-bg: #f9f9f9;
            --border-color: #ccc;
            --button-bg: #e0e0e0;
            --button-text: #000;
            --hover-bg: #d0d0d0;
        }

        .dark-mode {
            --bg-color: #121212;
            --text-color: #f0f0f0;
            --input-bg: #1e1e1e;
            --input-text: #f0f0f0;
            --card-bg: #1e1e1e;
            --border-color: #444;
            --button-bg: #3a3a3a;
            --button-text: #fff;
            --hover-bg: #555;
        }

        .theme-toggle {
            margin-bottom: 20px;
            text-align: right;
        }

        .group-management {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .add-card {
            margin-bottom: 20px;
        }

        input[type="text"], select {
            width: 200px;
            padding: 8px;
            margin-right: 10px;
            background-color: var(--input-bg);
            color: var(--input-text);
            border: 1px solid var(--border-color);
        }

        button {
            padding: 8px 15px;
            color: var(--button-text);
            background-color: var(--button-bg);
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: var(--hover-bg);
        }

        .flashcard {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: 0.3s;
            word-wrap: break-word;
            white-space: normal;
            border-radius: 5px;
        }

        .flashcard input[type="text"] {
            width: 100%;
            box-sizing: border-box;
            background-color: var(--input-bg);
            color: var(--input-text);
            border: 1px solid var(--border-color);
        }

        .flashcard:hover {
            box-shadow: 0 2px 10px rgba(255, 255, 255, 0.1);
        }

        .hidden {
            display: none;
        }

        #quiz-container {
            margin-top: 30px;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        #quiz-answer {
            padding: 8px;
            width: 300px;
            margin: 10px 0;
            background-color: var(--input-bg);
            color: var(--input-text);
            border: 1px solid var(--border-color);
        }

        .correct {
            color: #4CAF50;
            font-weight: bold;
        }

        .wrong {
            color: #f44336;
            font-weight: bold;
        }

        #group-select {
            flex-grow: 1;
            min-width: 200px;
        }

        .quiz-button {
            background: #2196F3;
            color: white;
        }

        .delete-group-btn {
            background: #d32f2f;
            color: white;
        }

        .delete-group-btn:hover {
            background: #b71c1c;
        }
        
    </style>
</head>
<body>
    <!-- Toggle theme switch -->
    <div class="theme-toggle">
        <label>
            <input type="checkbox" id="theme-switch" onchange="toggleTheme()"> Dark Mode
        </label>
    </div>
    <div class="group-management">
        <input type="text" id="new-group" placeholder="T√™n nh√≥m m·ªõi">
        <button onclick="createGroup()">T·∫°o nh√≥m</button>
        <select id="group-select" onchange="changeGroup(this.value)"></select>
        <button class="delete-group-btn" onclick="deleteCurrentGroup()">X√≥a nh√≥m</button>
        <input type="text" id="rename-group" placeholder="T√™n m·ªõi...">
        <button onclick="renameGroup()">ƒê·ªïi t√™n nh√≥m</button>

    </div>

    <h1>Flashcard c·ªßa b·∫°n</h1>
    
    <div class="add-card">
        <input type="text" id="question" placeholder="C√¢u h·ªèi...">
        <input type="text" id="answer" placeholder="C√¢u tr·∫£ l·ªùi...">
        <button onclick="addCard()">Th√™m th·∫ª</button>
    </div>

    <button class="quiz-button" onclick="startQuiz()">B·∫Øt ƒë·∫ßu Quiz</button>

    <div id="quiz-container" class="hidden">
        <div id="quiz-question"></div>
        <input type="text" id="quiz-answer" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi...">
        <button onclick="checkAnswer()">Ki·ªÉm tra</button>
        <div id="quiz-feedback"></div>
        <div id="quiz-score"></div>
    </div>

    <div id="flashcards"></div>

    <script>
        let groups = JSON.parse(localStorage.getItem('groups')) || [
            { id: 'default', name: 'M·∫∑c ƒë·ªãnh', cards: [] }
        ];
        let currentGroupId = 'default';
        let currentQuestionIndex = 0;
        let score = 0;
        let quizMode = false;

        // Ki·ªÉm tra ch·∫ø ƒë·ªô ƒë√£ l∆∞u
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            document.getElementById('theme-switch').checked = true;
        }

        // H√†m chuy·ªÉn ƒë·ªïi giao di·ªán
        function toggleTheme() {
            const isDark = document.getElementById('theme-switch').checked;
            if (isDark) {
                document.body.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark');
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('theme', 'light');
            }
        }
        // Ki·ªÉm tra ch·∫ø ƒë·ªô ƒë√£ l∆∞u
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            document.getElementById('theme-switch').checked = true;
        }

        // H√†m chuy·ªÉn ƒë·ªïi giao di·ªán
        function toggleTheme() {
            const isDark = document.getElementById('theme-switch').checked;
            if (isDark) {
                document.body.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark');
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('theme', 'light');
            }
        }

        // Kh·ªüi t·∫°o nh√≥m
        function initGroups() {
            const select = document.getElementById('group-select');
            select.innerHTML = groups.map(group => `
                <option value="${group.id}" ${group.id === currentGroupId ? 'selected' : ''}>
                    ${group.name} (${group.cards.length} th·∫ª)
                </option>
            `).join('');
        }

        function highlightDiff(wrong, correct) {
            const wrongWords = wrong.trim().split(/\s+/);
            const correctWords = correct.trim().split(/\s+/);
            let result = [];
        
            const maxLength = Math.max(wrongWords.length, correctWords.length);
            for (let i = 0; i < maxLength; i++) {
                const wrongWord = wrongWords[i] || '';
                const correctWord = correctWords[i] || '';
                if (wrongWord === correctWord) {
                    result.push(correctWord);
                } else {
                    result.push(`<span style="color: red; font-weight: bold">${correctWord}</span>`);
                }
            }
        
            return result.join(' ');
        }
        
        function createGroup() {
            const groupName = document.getElementById('new-group').value.trim();
            if (!groupName) return;
            
            const newGroup = {
                id: Date.now().toString(),
                name: groupName,
                cards: []
            };
            
            groups.push(newGroup);
            localStorage.setItem('groups', JSON.stringify(groups));
            initGroups();
            document.getElementById('new-group').value = '';
        }

        function changeGroup(groupId) {
            currentGroupId = groupId;
            renderCards();
        }

        function deleteCurrentGroup() {
            if (currentGroupId === 'default') {
                alert("Kh√¥ng th·ªÉ x√≥a nh√≥m m·∫∑c ƒë·ªãnh!");
                return;
            }
            
            if (confirm("X√≥a nh√≥m n√†y v√† to√†n b·ªô th·∫ª b√™n trong?")) {
                groups = groups.filter(g => g.id !== currentGroupId);
                currentGroupId = 'default';
                saveGroups();
                initGroups();
                renderCards();
            }
        }

        function startQuiz() {
            const currentGroup = groups.find(g => g.id === currentGroupId);
            if (currentGroup.cards.length === 0) {
                alert("Vui l√≤ng th√™m th·∫ª v√†o nh√≥m n√†y tr∆∞·ªõc!");
                return;
            }
            
            quizMode = true;
            currentQuestionIndex = 0;
            score = 0;
            document.getElementById('quiz-container').classList.remove('hidden');
            document.getElementById('flashcards').classList.add('hidden');
            document.querySelector('.add-card').classList.add('hidden');
            showNextQuestion();
        }

        function showNextQuestion() {
            const currentGroup = groups.find(g => g.id === currentGroupId);
            if (currentQuestionIndex >= currentGroup.cards.length) {
                endQuiz();
                return;
            }
            
            const quizQuestion = document.getElementById('quiz-question');
            quizQuestion.textContent = currentGroup.cards[currentQuestionIndex].question;
            document.getElementById('quiz-answer').value = '';
            document.getElementById('quiz-feedback').innerHTML = '';
        }

        function checkAnswer() {
            const currentGroup = groups.find(g => g.id === currentGroupId);
            const userAnswer = document.getElementById('quiz-answer').value.trim().toLowerCase();
            const correctAnswer = currentGroup.cards[currentQuestionIndex].answer.trim().toLowerCase();
            const feedback = document.getElementById('quiz-feedback');

            if (userAnswer === correctAnswer) {
                feedback.innerHTML = '<span class="correct">Correct! üéâ</span>';
                score++;
            } else {
                feedback.innerHTML = `
                    <span class="wrong">Sai r·ªìi üò¢</span>
                    <div>ƒê√°p √°n ƒë√∫ng: ${currentGroup.cards[currentQuestionIndex].answer}</div>
                `;
            }

            currentQuestionIndex++;
            setTimeout(showNextQuestion, 5000);
        }

        function endQuiz() {
            const currentGroup = groups.find(g => g.id === currentGroupId);
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('flashcards').classList.remove('hidden');
            document.querySelector('.add-card').classList.remove('hidden');
            
            alert(`K·∫øt th√∫c! ƒêi·ªÉm c·ªßa b·∫°n: ${score}/${currentGroup.cards.length}`);
            quizMode = false;
        }

        function renderCards() {
            const container = document.getElementById('flashcards');
            container.innerHTML = '';
            
            const currentGroup = groups.find(g => g.id === currentGroupId);
            if (!currentGroup) return;

            currentGroup.cards.forEach((card, index) => {
                const cardEl = document.createElement('div');
                cardEl.className = 'flashcard';
                cardEl.innerHTML = `
                    <div>${card.question}</div>
                    <div class="${card.showAnswer ? '' : 'hidden'}">${card.answer}</div>
                    <button onclick="deleteCard(${index})">X√≥a</button>
                `;

                cardEl.addEventListener('click', () => {
                    currentGroup.cards[index].showAnswer = !currentGroup.cards[index].showAnswer;
                    saveGroups();
                    renderCards();
                });

                container.appendChild(cardEl);
            });
        }
        function renderCards() {
            const container = document.getElementById('flashcards');
            container.innerHTML = '';
            const currentGroup = groups.find(g => g.id === currentGroupId);
            if (!currentGroup) return;

            currentGroup.cards.forEach((card, index) => {
                const cardEl = document.createElement('div');
                cardEl.className = 'flashcard';

                const questionInput = `<input type="text" value="${card.question}" onchange="editCard(${index}, 'question', this.value)">`;
                const answerInput = `<input type="text" value="${card.answer}" onchange="editCard(${index}, 'answer', this.value)">`;

                cardEl.innerHTML = `
                    <div><strong>Q:</strong> ${questionInput}</div>
                    <div class="${card.showAnswer ? '' : 'hidden'}"><strong>A:</strong> ${answerInput}</div>
                    <button onclick="deleteCard(${index})">X√≥a</button>
                `;

                cardEl.addEventListener('click', (e) => {
                    if (e.target.tagName.toLowerCase() !== 'input' && e.target.tagName.toLowerCase() !== 'button') {
                        currentGroup.cards[index].showAnswer = !currentGroup.cards[index].showAnswer;
                        saveGroups();
                        renderCards();
                    }
                });

                container.appendChild(cardEl);
            });
        }

        function editCard(index, field, value) {
            const currentGroup = groups.find(g => g.id === currentGroupId);
            if (field === 'question') currentGroup.cards[index].question = value;
            else if (field === 'answer') currentGroup.cards[index].answer = value;
            saveGroups();
        }

        function addCard() {
            const question = document.getElementById('question').value;
            const answer = document.getElementById('answer').value;
            
            if (question && answer) {
                const currentGroup = groups.find(g => g.id === currentGroupId);
                currentGroup.cards.push({
                    question,
                    answer,
                    showAnswer: false
                });
                saveGroups();
                renderCards();
                document.getElementById('question').value = '';
                document.getElementById('answer').value = '';
            }
        }

        function deleteCard(index) {
            const currentGroup = groups.find(g => g.id === currentGroupId);
            currentGroup.cards.splice(index, 1);
            saveGroups();
            renderCards();
        }

        function saveGroups() {
            localStorage.setItem('groups', JSON.stringify(groups));
        }
        // Th√™m s·ª± ki·ªán Enter ƒë·ªÉ th√™m th·∫ª
        document.getElementById('answer').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addCard();
            }
        });        

        // Kh·ªüi t·∫°o ban ƒë·∫ßu
        initGroups();
        renderCards();

        // X·ª≠ l√Ω ph√≠m Enter trong quiz
        document.getElementById('quiz-answer').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') checkAnswer();
        });

        document.getElementById('question').addEventListener('keydown', function(e) {
            if (e.key === 'Tab') {
                e.preventDefault();
                document.getElementById('answer').focus();
            }
        });

        document.getElementById('answer').addEventListener('keydown', function(e) {
            if (e.key === 'Tab') {
                e.preventDefault();
                document.getElementById('question').focus();
            }
        });

        function renameGroup() {
            const newName = document.getElementById('rename-group').value.trim();
            if (!newName) {
                alert("Vui l√≤ng nh·∫≠p t√™n m·ªõi cho nh√≥m.");
                return;
            }
        
            const currentGroup = groups.find(g => g.id === currentGroupId);
            if (!currentGroup) return;
        
            currentGroup.name = newName;
            saveGroups();
            initGroups();
            document.getElementById('rename-group').value = '';
        }
        
    </script>
</body>
</html>
